# A-03 — thread를 optional로 둘지 first-class key로 올릴지

## 문맥
- thread 모델링은 큐 키, 동시성 키, 저장 키까지 연동된다. 초기에 고정하지 않으면 메시지 정합성 버그가 누적된다.

## 선택지별 트레이드오프
### A) chat 안의 optional thread
- 트레이드오프: 기존 구조와 호환성이 좋지만 thread 분리 큐 제어가 약해질 수 있다.
- 되돌리기 비용(코드 변경량): 500줄 미만

### B) first-class key(chatId:threadId)
- 트레이드오프: 정합성은 강하지만 단일 chat 기준 코드 전체를 수정해야 한다.
- 되돌리기 비용(코드 변경량): 300줄 미만

## 질문 중요도
- 최대 되돌리기 비용: 500줄 미만
- 중요도: 매우 높음 (되돌릴 때 바뀌는 코드 경로의 폭 기준)

## 결정 체크포인트
- 선택 즉시 영향받는 영역: 포트 인터페이스, 핸들러/서비스 분기, 테스트 전략
- 결정 후 확인할 지표: 회귀 실패율, PR 크기, 리팩토링 단계 충돌 건수
