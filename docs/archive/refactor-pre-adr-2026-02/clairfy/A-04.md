# A-04 — 순서 보장 기준을 message_id/timestamp/hybrid 중 무엇으로 할지

## 문맥
- 정렬 키는 race condition과 steering 누락의 직접 원인이다. 선택이 잘못되면 큐/버퍼 설계를 다시 뜯어야 한다.

## 선택지별 트레이드오프
### A) Telegram message_id 기준
- 트레이드오프: Telegram 환경에선 강하지만 멀티채널 일반화에 약하다.
- 되돌리기 비용(코드 변경량): 300줄 미만

### B) 서버 timestamp 기준
- 트레이드오프: 채널 중립적이지만 동일 타임스탬프/지연 편차 처리 보완이 필요하다.
- 되돌리기 비용(코드 변경량): 300줄 미만

### C) Hybrid(message_id 우선 + timestamp 보조)
- 트레이드오프: 정합성은 가장 강하지만 구현/검증 복잡도가 높다.
- 되돌리기 비용(코드 변경량): 300줄 미만

## 질문 중요도
- 최대 되돌리기 비용: 300줄 미만
- 중요도: 높음 (되돌릴 때 바뀌는 코드 경로의 폭 기준)

## 결정 체크포인트
- 선택 즉시 영향받는 영역: 포트 인터페이스, 핸들러/서비스 분기, 테스트 전략
- 결정 후 확인할 지표: 회귀 실패율, PR 크기, 리팩토링 단계 충돌 건수
