# W-04 — 작업 디렉토리 격리를 per-user/per-channel/hybrid 중 무엇으로 할지

## 문맥
- soma-work는 `BASE_DIRECTORY/{userId}` 고정 전략을 사용한다. v3에서 Slack 최소지원을 고려하면 파일 접근 경계가 핵심 보안 축이다.

## 선택지별 트레이드오프
### A) per-user
- 트레이드오프: 격리는 좋지만 채널 공동작업 문맥 공유가 약하다.
- 되돌리기 비용(코드 변경량): 300줄 미만

### B) per-channel
- 트레이드오프: 협업은 쉽지만 사용자 간 오염 가능성이 높아진다.
- 되돌리기 비용(코드 변경량): 300줄 미만

### C) hybrid(tenant/user/channel)
- 트레이드오프: 유연하지만 경로 규칙과 검증 복잡도가 높다.
- 되돌리기 비용(코드 변경량): 500줄 미만

## 질문 중요도
- 최대 되돌리기 비용: 500줄 미만
- 중요도: 매우 높음 (되돌릴 때 바뀌는 코드 경로의 폭 기준)

## 결정 체크포인트
- 선택 즉시 영향받는 영역: 식별자 스키마, 세션 키, 권한/저장소 partition, 채널 어댑터 계약
- 결정 후 확인할 지표: 세션 충돌 건수, 권한 오판률, adapter 변경량, cross-repo 드리프트 건수
